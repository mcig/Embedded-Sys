.text 
.global main
; Digital IO Regs
.EQU PORTB, 0x03   		
.EQU DDRB, 0x04

.EQU PORTD, 0x0B   		
.EQU DDRD, 0x0A

; EEPROM Read/Write Regs
.EQU EECR, 0x1F
.EQU EEDR, 0x20
.EQU EEARL,  0x21
.EQU EEARH,  0x22
.EQU EERE, 0
.EQU EEWE, 1
.EQU EEMWE, 2

; EEPROM Read/Write Address
.EQU EEPROM_LOW_ADDRESS, 0x2A
.EQU EEPROM_HIGH_ADDRESS, 0x01

main:
	; Digital IO Inits
    LDI R16, 0B11111100
	OUT DDRD, R16
	
    LDI R16, 0B00000011
	OUT DDRB, R16
		
	; EEPROM GPRs
	LDI R27, EEPROM_LOW_ADDRESS
	LDI R28, EEPROM_HIGH_ADDRESS
	
	; read start value from eeprom
POLL_EEPROM_READ:
	SBIC EECR, EEWE
	RJMP POLL_EEPROM_READ
	
	OUT EEARL, R27
	OUT EEARH, R28
	SBI EECR, EERE
	IN R18, EEDR
MAIN_LOOP:
    ; Delay Registers
	ldi r29, 100
	ldi r30, 150
	ldi r31, 200
	; end delay registers

    LDI R19, 0b00000000
	LDI R20, 0b00000000
	CPI R18, 0
	BREQ GOT_VALUES

	LDI R19, 0b00000100
	LDI R20, 0b00000000
	CPI R18, 1
	BREQ GOT_VALUES

	LDI R19, 0b00001100
	LDI R20, 0b00000000
	CPI R18, 2
	BREQ GOT_VALUES

	LDI R19, 0b00011100
	LDI R20, 0b00000000
	CPI R18, 3
	BREQ GOT_VALUES

	LDI R19, 0b00111100
	LDI R20, 0b00000000
	CPI R18, 4
	BREQ GOT_VALUES

	LDI R19, 0b01111100
	LDI R20, 0b00000000
	CPI R18, 5
	BREQ GOT_VALUES

	LDI R19, 0b11111100
	LDI R20, 0b00000000
	CPI R18, 6
	BREQ GOT_VALUES

	LDI R19, 0b11111100
	LDI R20, 0000000001
	CPI R18, 7
	BREQ GOT_VALUES

	LDI R19, 0b11111100
	LDI R20, 0b00000011
	CPI R18, 8
	BREQ GOT_VALUES

GOT_VALUES:
	CPI R18, 8
	BRNE SKIP_RESET

	LDI R18, 0
	RJMP OUTPUT_VALUES
SKIP_RESET:
	inc r18
OUTPUT_VALUES:
	OUT PORTD, R19
	OUT PORTB, R20

	LONG_DELAY:
	dec r31
	brne LONG_DELAY
	dec r30
	brne LONG_DELAY
	dec r29
	brne LONG_DELAY

EEPROM_WRITE_POLL:
	SBIC EECR, EEWE
	RJMP EEPROM_WRITE_POLL

	OUT EEARL, R27
	OUT EEARH, R28

	OUT EEDR, R18

	SBI EECR, EEMWE
	SBI EECR, EEWE

	rjmp MAIN_LOOP
	